import { JetView } from "webix-jet";
import { ROOT_URL, CLS_FIELD } from "~/util/constants.js";

export default class DataView extends JetView {
  config() {
    return {
      rows: [
        {
          view: "search",
          id: "tableSearch",
          placeholder: "Search...",
          on: {
            onTimedKeyPress: function() {
              const value = this.getValue().toLowerCase();
              if (!value) {
                $$("fieldTable").filter();
              } else {
                $$("fieldTable").filter(function(obj) {
                  return obj.name.toLowerCase().indexOf(value) != -1;
                });
              }
            }
          }
        },
        {
          view: "datatable",
          id: "fieldTable",
          columnWidth: 200,
          url: ROOT_URL + CLS_FIELD,
          select: true, //enables selection
          columns: [
            { id: "name", header: "Name" },
            { id: "number", header: "Number" }
          ],
          pager: "pager"
        },
        {
          view: "pager",
          id: "pager",
          size: 5,
          group: 5
        }
      ]
    };
  }

  init() {
    $$("fieldTable").attachEvent("onItemDblClick", item =>
      this.app.show("/top/field-form?id=" + item.row)
    );
  }
}
